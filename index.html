<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>åˆ›æ„å‘æ•£åŠ©æ‰‹</title>
    <style>
        body { margin: 0; background: #fdfdfd; font-family: sans-serif; height: 100vh; overflow: hidden; }
        #canvas { width: 100%; height: 100%; position: relative; }
        .bubble { position: absolute; padding: 15px 25px; background: white; border: 1px solid #ddd; border-radius: 40px; cursor: pointer; transform: translate(-50%, -50%); transition: 0.3s; text-align: center; }
        .bubble:hover { background: #FFD700; transform: translate(-50%, -50%) scale(1.1); }
        .zh { display: block; font-weight: bold; }
        .en { font-size: 10px; color: #888; }
        .footer { position: fixed; bottom: 30px; width: 100%; text-align: center; }
        input { padding: 12px; border-radius: 20px; border: 1px solid #000; width: 260px; outline: none; }
        #set-api { cursor: pointer; border: none; background: none; font-size: 20px; }
        #loader { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); display: none; background: #000; color: #fff; padding: 10px; border-radius: 10px; z-index: 99; }
    </style>
</head>
<body>
    <div id="loader">Gemini æ­£åœ¨è”æƒ³...</div>
    <div id="canvas"></div>
    <div class="footer">
        <input type="text" id="in" placeholder="è¾“å…¥è¯è¯­å¹¶å›è½¦...">
        <button id="set-api">ğŸ”‘</button>
    </div>
    <script>
        let apiKey = "";
        const canvas = document.getElementById('canvas');
        const input = document.getElementById('in');

        document.getElementById('set-api').onclick = () => {
            const k = prompt("è¯·è¾“å…¥ API Key:");
            if(k) apiKey = k.trim();
        };

        input.onkeypress = (e) => {
            if (e.key === 'Enter' && input.value) {
                addBubble(input.value, "START", window.innerWidth/2, window.innerHeight/2);
                input.value = "";
            }
        };

        function addBubble(zh, en, x, y) {
            const b = document.createElement('div');
            b.className = 'bubble';
            b.style.left = x + 'px'; b.style.top = y + 'px';
            b.innerHTML = `<span class="zh">${zh}</span><span class="en">${en}</span>`;
            b.onclick = () => spread(zh, x, y);
            canvas.appendChild(b);
        }

        async function spread(word, x, y) {
            if(!apiKey) return alert("è¯·å…ˆè®¾ç½® Key");
            document.getElementById('loader').style.display = 'block';
            
            // --- æ ¸å¿ƒä¿®å¤ï¼šæ‰‹åŠ¨æ‹¼æ¥ï¼Œç¡®ä¿ç½‘å€ä¸è¢«æˆªæ–­ ---
            const base = "https://generativelanguage.googleapis.com";
            const mid = "/v1beta/models/gemini-1.5-flash";
            const action = ":generateContent"; 
            const url = base + mid + action + "?key=" + apiKey;

            try {
                const res = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: "ç»™å‡º8ä¸ªå’Œ'" + word + "'ç›¸å…³çš„è¯,æ ¼å¼:ä¸­æ–‡(è‹±æ–‡),ç”¨é€—å·éš”å¼€" }] }] })
                });
                const data = await res.json();
                if (data.candidates) {
                    const text = data.candidates[0].content.parts[0].text;
                    text.split(/[,ï¼Œ]/).forEach((item, i) => {
                        const a = (i / 8) * 6.28;
                        const parts = item.split(/[()]/);
                        addBubble(parts[0], parts[1] || "AI", x + Math.cos(a)*160, y + Math.sin(a)*160);
                    });
                } else {
                    console.error("API Error:", data);
                    alert("Gemini è¿”å›äº†é”™è¯¯ï¼Œè¯·æ£€æŸ¥ Key æˆ–èŠ‚ç‚¹åœ°åŒº");
                }
            } catch (e) { 
                console.error(e);
                alert("è¯·æ±‚å¤±è´¥ï¼Œè¯·ç¡®ä¿æ¢¯å­å¼€å¯å…¨å±€æ¨¡å¼"); 
            }
            document.getElementById('loader').style.display = 'none';
        }
    </script>
</body>
</html>
