<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>åˆ›æ„å‘æ•£åŠ©æ‰‹</title>
    <style>
        body { margin: 0; background: #fdfdfd; font-family: -apple-system, sans-serif; height: 100vh; overflow: hidden; }
        #canvas { width: 100%; height: 100%; position: relative; }
        .bubble {
            position: absolute; padding: 15px 25px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 40px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.05);
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer; text-align: center;
            transform: translate(-50%, -50%);
        }
        .bubble:hover { background: #FFD700; border-color: #000; transform: translate(-50%, -50%) scale(1.15); box-shadow: 0 12px 40px rgba(255,215,0,0.3); }
        .zh { display: block; font-weight: bold; color: #000; font-size: 16px; }
        .en { font-size: 11px; color: #777; text-transform: uppercase; letter-spacing: 1px; }
        .footer { position: fixed; bottom: 40px; width: 100%; display: flex; justify-content: center; gap: 15px; align-items: center; }
        input { padding: 14px 28px; border-radius: 30px; border: 2px solid #000; width: 320px; outline: none; font-size: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        #set-api { width: 50px; height: 50px; background: #000; color: #fff; border-radius: 50%; cursor: pointer; border: none; font-size: 22px; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        #set-api:hover { transform: rotate(15deg) scale(1.1); }
        #loader { position: fixed; top: 30px; left: 50%; transform: translateX(-50%); display: none; background: #000; color: #FFD700; padding: 10px 25px; border-radius: 25px; font-weight: bold; z-index: 100; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
    </style>
</head>
<body>
    <div id="loader">Gemini æ­£åœ¨è”æƒ³ä¸­...</div>
    <div id="canvas"></div>
    <div class="footer">
        <input type="text" id="in" placeholder="è¾“å…¥çµæ„Ÿè¯æ±‡å¹¶å›è½¦...">
        <button id="set-api">ğŸ”‘</button>
    </div>
    <script>
        let apiKey = ""; 
        const canvas = document.getElementById('canvas');
        const input = document.getElementById('in');

        document.getElementById('set-api').onclick = () => {
            const key = prompt("è¯·è¾“å…¥ä½ çš„ Gemini API Key:");
            if(key) { apiKey = key.trim(); alert("Key å·²å°±ç»ªï¼"); }
        };

        input.onkeypress = (e) => {
            if (e.key === 'Enter' && input.value.trim() !== "") {
                addBubble(input.value.trim(), "START", window.innerWidth/2, window.innerHeight/2);
                input.value = "";
            }
        };

        function addBubble(zh, en, x, y) {
            const b = document.createElement('div');
            b.className = 'bubble';
            b.style.left = x + 'px'; b.style.top = y + 'px';
            b.innerHTML = `<span class="zh">${zh}</span><span class="en">${en}</span>`;
            b.onclick = (e) => { e.stopPropagation(); spread(zh, x, y); };
            canvas.appendChild(b);
        }

        async function spread(word, x, y) {
            if(!apiKey) return alert("è¯·å…ˆç‚¹å‡»ğŸ”‘è®¾ç½® API Keyï¼");
            document.getElementById('loader').style.display = 'block';
            
            // ä½¿ç”¨æœ€å®Œæ•´ä¸”æ­£ç¡®çš„ URL
            const url = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=" + apiKey;

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `ä½ æ˜¯ä¸€ä¸ªåˆ›æ„å‘æ•£åŠ©æ‰‹ã€‚è¯·æ ¹æ®è¯è¯­ "${word}" ç»™å‡º8ä¸ªç›¸å…³çš„å…³è”è¯ã€‚è¦æ±‚ï¼šæ¯ä¸ªè¯åŒ…å« ä¸­æ–‡(è‹±æ–‡) æ ¼å¼ï¼Œç”¨é€—å·éš”å¼€ï¼Œä¸è¦è§£é‡Šã€‚` }] }]
                    })
                });

                const data = await response.json();
                
                if (data.candidates && data.candidates[0]) {
                    const aiText = data.candidates[0].content.parts[0].text;
                    const keywords = aiText.split(/[,ï¼Œ]/).map(s => s.trim());
                    keywords.forEach((item, i) => {
                        const angle = (i / keywords.length) * Math.PI * 2;
                        const dist = 180;
                        const parts = item.split(/[()ï¼ˆï¼‰]/);
                        addBubble(parts[0], parts[1] || "Idea", x + Math.cos(angle)*dist, y + Math.sin(angle)*dist);
                    });
                } else {
                    console.error("API Error:", data);
                    alert("Gemini è¿”å›äº†é”™è¯¯ï¼Œè¯·æ£€æŸ¥ Key çš„æœ‰æ•ˆæ€§æˆ–ç½‘ç»œã€‚");
                }
            } catch (e) { 
                console.error("Fetch Error:", e);
                alert("è¯·æ±‚å¤±è´¥ï¼Œè¯·ç¡®ä¿ä½ çš„ç§‘å­¦ä¸Šç½‘å·¥å…·å¼€å¯äº†â€œå…¨å±€æ¨¡å¼â€ã€‚"); 
            }
            document.getElementById('loader').style.display = 'none';
        }
    </script>
</body>
</html>
