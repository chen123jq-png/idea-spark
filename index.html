<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>åˆ›æ„å‘æ•£åŠ©æ‰‹</title>
    <style>
        body { margin: 0; background: #ffffff; font-family: sans-serif; height: 100vh; overflow: hidden; }
        #canvas { width: 100%; height: 100%; position: relative; }
        .bubble {
            position: absolute; padding: 12px 20px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transition: 0.3s; cursor: pointer; text-align: center;
            transform: translate(-50%, -50%);
        }
        .bubble:hover { background: #FFD700; border-color: #000; transform: translate(-50%, -50%) scale(1.1); }
        .zh { display: block; font-weight: bold; color: #000; }
        .en { font-size: 10px; color: #666; text-transform: uppercase; }
        .footer { position: fixed; bottom: 30px; width: 100%; display: flex; justify-content: center; gap: 10px; }
        input { padding: 12px 25px; border-radius: 25px; border: 2px solid #000; width: 300px; outline: none; }
        #set-api { padding: 10px; background: #000; color: #fff; border-radius: 50%; cursor: pointer; border: none; font-size: 20px; }
        #loader { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); display: none; background: #000; color: #FFD700; padding: 8px 20px; border-radius: 20px; }
    </style>
</head>
<body>
    <div id="loader">Gemini æ­£åœ¨è”æƒ³ä¸­...</div>
    <div id="canvas"></div>
    <div class="footer">
        <input type="text" id="in" placeholder="è¾“å…¥çµæ„Ÿè¯æ±‡å¹¶å›è½¦...">
        <button id="set-api">ğŸ”‘</button>
    </div>
    <script>
        let apiKey = ""; 
        const canvas = document.getElementById('canvas');
        const input = document.getElementById('in');

        document.getElementById('set-api').onclick = () => {
            const key = prompt("è¯·è¾“å…¥ä½ çš„ Gemini API Key:");
            if(key) { apiKey = key; alert("Key å·²å°±ç»ªï¼"); }
        };

        input.onkeypress = (e) => {
            if (e.key === 'Enter' && input.value.trim() !== "") {
                addBubble(input.value.trim(), "START", window.innerWidth/2, window.innerHeight/2);
                input.value = "";
            }
        };

        function addBubble(zh, en, x, y) {
            const b = document.createElement('div');
            b.className = 'bubble';
            b.style.left = x + 'px'; b.style.top = y + 'px';
            b.innerHTML = `<span class="zh">${zh}</span><span class="en">${en}</span>`;
            b.onclick = (e) => { e.stopPropagation(); spread(zh, x, y); };
            canvas.appendChild(b);
        }

        async function spread(word, x, y) {
            if(!apiKey) return alert("è¯·ç‚¹å‡»å³ä¸‹è§’ğŸ”‘è®¾ç½® Keyï¼");
            document.getElementById('loader').style.display = 'block';
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: `ç»™å‡º8ä¸ªå’Œ"${word}"ç›¸å…³çš„åˆ›æ„è¯,æ ¼å¼:ä¸­æ–‡(è‹±æ–‡),ç”¨é€—å·éš”å¼€,ä¸è¦è§£é‡Š` }] }] })
                });
                const data = await response.json();
                const keywords = data.candidates[0].content.parts[0].text.split(/[,ï¼Œ]/).map(s => s.trim());
                keywords.forEach((item, i) => {
                    const angle = (i / keywords.length) * Math.PI * 2;
                    const parts = item.split(/[()ï¼ˆï¼‰]/);
                    addBubble(parts[0], parts[1] || "Idea", x + Math.cos(angle)*160, y + Math.sin(angle)*160);
                });
            } catch (e) { alert("å‡ºé”™å•¦ï¼Œè¯·æ£€æŸ¥ Key æˆ–ç½‘ç»œ"); }
            document.getElementById('loader').style.display = 'none';
        }
    </script>
</body>
</html>
